<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>è¯†å­—å¡ï½œäººæ•™ç‰ˆ ä¸€ï½äºŒå¹´çº§ï¼ˆä¸Š/ä¸‹ï¼‰</title>
<style>
  :root {
    /* æ—¥å¼é…è‰²æ–¹æ¡ˆ */
    --bg-primary: #faf8f5;     /* ç±³ç™½è‰²èƒŒæ™¯ */
    --bg-secondary: #f5f2ed;   /* æµ…ç±³è‰² */
    --card: #ffffff;           /* çº¯ç™½å¡ç‰‡ */
    --text-primary: #2c2c2c;   /* æ·±ç°è‰²æ–‡å­— */
    --text-secondary: #6b6b6b; /* ä¸­ç°è‰² */
    --text-muted: #9a9a9a;     /* æµ…ç°è‰² */
    --accent: #8b7355;         /* æ—¥å¼æ£•è‰² */
    --accent-light: #a68b5b;   /* æµ…æ£•è‰² */
    --border: #e8e3dd;         /* æµ…æ£•è‰²è¾¹æ¡† */
    --shadow: 0 8px 32px rgba(139, 115, 85, 0.08);
    --radius: 12px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
    color: var(--text-primary);
    font: 16px/1.6 "Hiragino Sans", "Hiragino Kaku Gothic ProN", "Yu Gothic", "Meiryo", "Noto Sans CJK JP", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
    min-height: 100vh;
    letter-spacing: 0.02em;
  }
  
  /* ç§»åŠ¨ç«¯ä¼˜åŒ–çš„å¤´éƒ¨ */
  header{
    padding: 16px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border);
    box-shadow: 0 2px 8px rgba(139, 115, 85, 0.05);
  }
  h1{
    margin: 0;
    font-size: 20px;
    font-weight: 500;
    color: var(--text-primary);
    letter-spacing: 0.05em;
  }
  .settings-btn{
    background: var(--accent);
    color: #fff;
    border: none;
    padding: 10px 16px;
    border-radius: 24px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(139, 115, 85, 0.2);
  }
  .settings-btn:hover{
    background: var(--accent-light);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(139, 115, 85, 0.3);
  }
  
  /* ä¸»å®¹å™¨ */
  .main-container{padding:20px 16px;max-width:480px;margin:0 auto;min-height:calc(100vh - 60px);display:flex;flex-direction:column;justify-content:center}
  
  /* å•å¡ç‰‡æ˜¾ç¤º */
  .card-container{display:flex;justify-content:center;margin:24px 0}
  .card{
    perspective: 1000px;
    width: 300px;
    height: 300px;
    position: relative;
  }
  .card-inner{
    position: absolute;
    inset: 0;
    border-radius: var(--radius);
    transform-style: preserve-3d;
    transition: transform 0.7s cubic-bezier(0.25, 0.8, 0.25, 1);
    box-shadow: var(--shadow);
    background: var(--card);
    border: 1px solid var(--border);
  }
  .card.flipped .card-inner{transform: rotateY(180deg)}
  .face{
    position: absolute;
    inset: 0;
    backface-visibility: hidden;
    border-radius: var(--radius);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    padding: 24px;
  }
  .front{
    background: linear-gradient(135deg, #ffffff 0%, #fefefe 100%);
    border: 1px solid var(--border);
  }
  .back{
    background: linear-gradient(135deg, var(--accent) 0%, var(--accent-light) 100%);
    color: #fff;
    transform: rotateY(180deg);
  }
  .hanzi{
    font-size: 88px;
    font-weight: 400;
    letter-spacing: 0.1em;
    margin-bottom: 12px;
    color: var(--text-primary);
    text-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }
  .pinyin{
    font-size: 36px;
    font-weight: 300;
    letter-spacing: 0.15em;
    margin-bottom: 12px;
    color: #fff;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  }
  .tag{
    position: absolute;
    top: 16px;
    left: 16px;
    background: rgba(139, 115, 85, 0.1);
    color: var(--accent);
    padding: 6px 12px;
    border-radius: 16px;
    font-size: 11px;
    font-weight: 500;
    letter-spacing: 0.05em;
    border: 1px solid rgba(139, 115, 85, 0.2);
  }
  .hint{
    font-size: 13px;
    color: var(--text-muted);
    text-align: center;
    margin-top: 8px;
    letter-spacing: 0.02em;
  }
  
  /* æ§åˆ¶æŒ‰é’® */
  .controls{
    display: flex;
    justify-content: center;
    gap: 16px;
    margin: 24px 0;
  }
  button{
    appearance: none;
    border: none;
    background: var(--accent);
    color: #fff;
    padding: 14px 24px;
    border-radius: 28px;
    cursor: pointer;
    font-weight: 500;
    font-size: 14px;
    letter-spacing: 0.02em;
    box-shadow: 0 4px 16px rgba(139, 115, 85, 0.2);
    transition: all 0.3s ease;
    border: 1px solid transparent;
  }
  button:hover{
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(139, 115, 85, 0.3);
    background: var(--accent-light);
  }
  button.secondary{
    background: #fff;
    color: var(--accent);
    border: 1px solid var(--accent);
    box-shadow: 0 2px 8px rgba(139, 115, 85, 0.1);
  }
  button.secondary:hover{
    background: var(--accent);
    color: #fff;
    box-shadow: 0 4px 16px rgba(139, 115, 85, 0.2);
  }
  button.ghost{
    background: transparent;
    color: var(--text-secondary);
    border: 1px solid var(--border);
    box-shadow: none;
  }
  button.ghost:hover{
    background: var(--bg-secondary);
    color: var(--text-primary);
    border-color: var(--accent);
  }
  
  /* è¿›åº¦ä¿¡æ¯ */
  .progress{
    text-align: center;
    margin: 20px 0;
    color: var(--text-secondary);
    font-size: 15px;
    font-weight: 400;
    letter-spacing: 0.02em;
  }
  
  /* è®¾ç½®å¼¹çª— */
  .modal{
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.4);
    display: none;
    align-items: center;
    justify-content: center;
    padding: 20px;
    z-index: 1000;
    backdrop-filter: blur(4px);
  }
  .modal.show{display: flex}
  .dialog{
    width: min(420px, 90vw);
    background: #fff;
    border-radius: 24px;
    box-shadow: 0 24px 64px rgba(139, 115, 85, 0.15);
    padding: 28px;
    max-height: 85vh;
    overflow-y: auto;
    border: 1px solid var(--border);
  }
  .dialog h3{
    margin: 0 0 20px;
    font-size: 20px;
    text-align: center;
    color: var(--text-primary);
    font-weight: 500;
    letter-spacing: 0.02em;
  }
  
  /* è®¾ç½®å†…å®¹ */
  .setting-group{margin-bottom: 24px}
  .setting-group label{
    display: block;
    margin-bottom: 10px;
    font-weight: 500;
    color: var(--text-primary);
    font-size: 15px;
    letter-spacing: 0.01em;
  }
  select, input[type="number"]{
    width: 100%;
    padding: 12px 16px;
    border: 1px solid var(--border);
    border-radius: 12px;
    font-size: 14px;
    background: #fff;
    color: var(--text-primary);
    transition: all 0.2s ease;
    font-family: inherit;
  }
  select:focus, input[type="number"]:focus{
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(139, 115, 85, 0.1);
  }
  
  /* è¯¾æ–‡é€‰æ‹© */
  .lessons{
    max-height: 220px;
    overflow-y: auto;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 12px;
    background: var(--bg-primary);
  }
  .lessons h4{
    margin: 12px 0 8px;
    font-size: 14px;
    color: var(--text-secondary);
    font-weight: 500;
    letter-spacing: 0.01em;
  }
  .lesson-item{
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 10px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.2s ease;
    color: var(--text-primary);
  }
  .lesson-item:hover{
    background: var(--bg-secondary);
  }
  .lesson-item input{
    transform: scale(1.1);
    accent-color: var(--accent);
  }
  
  /* æŒ‰é’®ç»„ */
  .btn-group{
    display: flex;
    gap: 12px;
    margin-top: 20px;
  }
  .btn-group button{flex: 1}
  
  /* å“åº”å¼è°ƒæ•´ */
  @media (max-width: 480px) {
    .card{
      width: 260px;
      height: 260px;
    }
    .hanzi{
      font-size: 76px;
    }
    .pinyin{
      font-size: 30px;
    }
    .main-container{
      padding: 16px 12px;
    }
    .dialog{
      padding: 20px;
      margin: 10px;
    }
    .controls{
      gap: 12px;
    }
    button{
      padding: 12px 20px;
      font-size: 13px;
    }
  }
  
  @media (max-width: 360px) {
    .card{
      width: 240px;
      height: 240px;
    }
    .hanzi{
      font-size: 68px;
    }
    .pinyin{
      font-size: 26px;
    }
  }
</style>
</head>
<body>
  <header>
    <h1>è¯†å­—å¡</h1>
    <button id="btnSettings" class="settings-btn">âš™ï¸ è®¾ç½®</button>
  </header>

  <div class="main-container">
    <!-- è¿›åº¦ä¿¡æ¯ -->
    <div class="progress" id="progressInfo">ç‚¹å‡»"å¼€å§‹å­¦ä¹ "å¼€å§‹è¯†å­—</div>
    
    <!-- å•å¡ç‰‡æ˜¾ç¤º -->
    <div class="card-container">
      <div id="currentCard" class="card">
        <div class="card-inner">
          <div class="face front">
            <div class="tag">ç”Ÿå­—</div>
            <div class="hanzi" id="currentHanzi">å­—</div>
            <div class="hint">ç‚¹å‡»ç¿»é¢çœ‹æ‹¼éŸ³</div>
          </div>
          <div class="face back">
            <div class="tag">æ‹¼éŸ³</div>
            <div class="pinyin" id="currentPinyin">zÃ¬</div>
            <div class="hint">ç‚¹å‡»ç¿»é¢çœ‹ç”Ÿå­—</div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- æ§åˆ¶æŒ‰é’® -->
    <div class="controls">
      <button id="btnStart" class="secondary">å¼€å§‹å­¦ä¹ </button>
      <button id="btnPrev" class="ghost" style="display:none;">ä¸Šä¸€ä¸ª</button>
      <button id="btnNext" class="ghost" style="display:none;">ä¸‹ä¸€ä¸ª</button>
      <button id="btnShuffle" class="ghost" style="display:none;">ğŸ”€ éšæœº</button>
    </div>
  </div>

  <!-- è®¾ç½®å¼¹çª— -->
  <div class="modal" id="settingsModal">
    <div class="dialog">
      <h3>å­¦ä¹ è®¾ç½®</h3>
      
      <div class="setting-group">
        <label>é€‰æ‹©å†Œåˆ«ï¼š</label>
        <select id="bookSelect">
          <option value="1ä¸Š">ä¸€å¹´çº§ä¸Š</option>
          <option value="1ä¸‹">ä¸€å¹´çº§ä¸‹</option>
          <option value="2ä¸Š">äºŒå¹´çº§ä¸Š</option>
          <option value="2ä¸‹" selected>äºŒå¹´çº§ä¸‹</option>
          <option value="3ä¸Š">ä¸‰å¹´çº§ä¸Š</option>
          <option value="3ä¸‹">ä¸‰å¹´çº§ä¸‹</option>
        </select>
      </div>
      
      <div class="setting-group">
        <label>é€‰æ‹©è¯¾æ–‡ï¼š</label>
        <div id="lessonList" class="lessons"></div>
        <div style="display:flex;gap:8px;margin-top:8px;">
          <button id="btnSelectAll" class="ghost" style="flex:1;">å…¨é€‰</button>
          <button id="btnClear" class="ghost" style="flex:1;">æ¸…ç©º</button>
        </div>
      </div>
      
      <div class="setting-group">
        <label>å­¦ä¹ æ¨¡å¼ï¼š</label>
        <select id="studyMode">
          <option value="random">éšæœºé¡ºåº</option>
          <option value="sequential">æŒ‰è¯¾æ–‡é¡ºåº</option>
        </select>
      </div>
      
      <div class="btn-group">
        <button id="btnCloseSettings" class="secondary">å…³é—­</button>
        <button id="btnStartStudy">å¼€å§‹å­¦ä¹ </button>
      </div>
    </div>
  </div>

  <!-- æ•°æ®ç¼–è¾‘å™¨ï¼ˆå¯¼å…¥/å¯¼å‡º JSONï¼‰ -->
  <div class="modal" id="editModal">
    <div class="dialog">
      <h3>ç¼–è¾‘å½“å‰å†Œåˆ«çš„æ•°æ®ï¼ˆJSONï¼‰</h3>
      <div class="editor">
        <textarea id="jsonArea" spellcheck="false" style="min-height:200px;width:100%;padding:10px;border:1px solid #e0e0e0;border-radius:8px;font-family:monospace;font-size:12px;"></textarea>
        <div style="font-size:12px;color:#666;margin:8px 0;">
          è¯´æ˜ï¼šä¸€ä¸ªæ¡ç›®å½¢å¦‚
          <code>{"unit":1,"id":"1-1","title":"è¯¾æ–‡æ ‡é¢˜","chars":"å­— å­— å­—"}</code>ã€‚
          <br>ç²˜è´´ä½ æ‰‹å¤´æ›´å‡†ç¡®çš„å®˜æ–¹ç”Ÿå­—è¡¨åï¼Œç‚¹"ä¿å­˜"ã€‚ä»…å½±å“å½“å‰é€‰æ‹©çš„å†Œåˆ«ã€‚
        </div>
        <div class="btn-group">
          <button id="btnDownload" class="secondary">å¯¼å‡ºJSON</button>
          <button id="btnCancelEdit" class="ghost">å–æ¶ˆ</button>
          <button id="btnSave">ä¿å­˜</button>
        </div>
      </div>
    </div>
  </div>

  <!-- pinyin-proï¼ˆæ‹¼éŸ³åº“ï¼ŒCDNï¼‰ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pinyin-pro/3.27.0/index.js"></script>
  <script>
    // ========== æ•°æ®åŒº ==========
    // ç»“æ„ï¼šDATA[å†Œåˆ«] = LESSONS[]
    // å…¶ä¸­ LESSONS[]: {unit:æ•°å­—,id:"å•å…ƒ-åºå·",title:"è¯¾æ–‡æ ‡é¢˜",chars:"ç©ºæ ¼åˆ†éš”çš„å•å­—åˆ—è¡¨"}
    const DATA = {
      "1ä¸Š": [
        // â˜… ä¸€å¹´çº§ä¸Šï¼šç¤ºèŒƒæ•°æ®ï¼ˆå¯åœ¨â€œç¼–è¾‘â€é‡Œæ›¿æ¢ä¸ºä½ æ ¡æŒ‡å®šæ¸…å•ï¼‰
        {unit:1,id:"1-1",title:"è¯†å­—ï¼šå¤©åœ°äºº",chars:"å¤© åœ° äºº ä½  æˆ‘ ä»–"},
        {unit:1,id:"1-2",title:"è¯†å­—ï¼šé‡‘æœ¨æ°´ç«åœŸ",chars:"é‡‘ æœ¨ æ°´ ç« åœŸ"},
        {unit:1,id:"1-3",title:"è¯†å­—ï¼šå£è€³ç›®",chars:"å£ è€³ ç›® æ‰‹ è¶³"},
        {unit:1,id:"1-4",title:"è¯¾æ–‡ï¼šç§‹å¤©",chars:"ç§‹ é£ é›¨ å¶ æœ"},
        {unit:2,id:"2-5",title:"è¯¾æ–‡ï¼šç”»",chars:"ç”» æ˜Ÿ æœˆ å±± æ°´"},
        {unit:2,id:"2-6",title:"è¯†å­—ï¼šæ—¥æœˆæ°´ç«",chars:"æ—¥ æœˆ æ°´ ç«"},
        {unit:3,id:"3-7",title:"è¯¾æ–‡ï¼šå¤§å°å¤šå°‘",chars:"å¤§ å° å¤š å°‘ é•¿ çŸ­"},
        {unit:3,id:"3-8",title:"è¯¾æ–‡ï¼šå››å­£",chars:"æ˜¥ å¤ ç§‹ å†¬ å†· çƒ­"},
        {unit:4,id:"4-9",title:"è¯¾æ–‡ï¼šæ–‡å…·",chars:"ä¹¦ æœ¬ ç¬” å°º åŒ…"},
        {unit:4,id:"4-10",title:"è¯¾æ–‡ï¼šåŠ¨ç‰©æœ‹å‹",chars:"é¸Ÿ é±¼ è™« é©¬ ç‰›"},
      ],
      "1ä¸‹": [
        // â˜… ä¸€å¹´çº§ä¸‹ï¼šç¤ºèŒƒæ•°æ®ï¼ˆå¯åœ¨â€œç¼–è¾‘â€é‡Œæ›¿æ¢ï¼‰
        {unit:1,id:"1-1",title:"è¯†å­—ï¼šæ˜¥å¤ç§‹å†¬",chars:"æ˜¥ å¤ ç§‹ å†¬ èŠ± è‰ æ ‘"},
        {unit:1,id:"1-2",title:"è¯¾æ–‡ï¼šå°å…¬é¸¡å’Œå°é¸­å­",chars:"é¸¡ é¸­ æ²³ æ‰ æ‰¾"},
        {unit:1,id:"1-3",title:"è¯¾æ–‡ï¼šå¸é©¬å…‰",chars:"å¸ é©¬ å…‰ ç ¸ ç¼¸"},
        {unit:2,id:"2-4",title:"è¯†å­—ï¼šæ–¹ä½è¯",chars:"ä¸Š ä¸‹ å·¦ å³ å‰ å é‡Œ å¤–"},
        {unit:2,id:"2-5",title:"è¯¾æ–‡ï¼šåŠ¨ç‰©å„¿æ­Œ",chars:"çŒ« ç‹— ç†Š å…” ç‹"},
        {unit:3,id:"3-6",title:"è¯¾æ–‡ï¼šå½©è™¹",chars:"è™¹ é›¨ äº‘ äº® å½©"},
        {unit:3,id:"3-7",title:"è¯¾æ–‡ï¼šäº¤é€šå·¥å…·",chars:"è½¦ èˆ¹ é£ æœº"},
        {unit:4,id:"4-8",title:"è¯¾æ–‡ï¼šèŠ‚æ—¥",chars:"å¹´ èŠ‚ ç¯ èŠ± é¾™"},
        {unit:4,id:"4-9",title:"è¯¾æ–‡ï¼šç¤¼è²Œç”¨è¯­",chars:"è¯· è°¢ å¯¹ ä¸ å®¢ æ°”"},
      ],
      "2ä¸Š": [
        // â˜… äºŒå¹´çº§ä¸Šï¼šç¤ºèŒƒæ•°æ®ï¼ˆå¯åœ¨â€œç¼–è¾‘â€é‡Œæ›¿æ¢ï¼‰
        {unit:1,id:"1-1",title:"è¯†å­—ï¼šåœºæ™¯è¯",chars:"æ™¨ è¯» æ ¡ å›­ è‰ åœ° èŠ± é¦™"},
        {unit:1,id:"1-2",title:"è¯¾æ–‡ï¼šé»„å±±å¥‡çŸ³ï¼ˆèŠ‚é€‰ï¼‰",chars:"é»„ å±± å¥‡ çŸ³ å³°"},
        {unit:1,id:"1-3",title:"è¯¾æ–‡ï¼šå°æŸ³æ ‘å’Œå°æ£æ ‘",chars:"æŸ³ æ£ æ ‘ æ å¶"},
        {unit:2,id:"2-4",title:"è¯†å­—ï¼šé¢œè‰²è¯",chars:"çº¢ é»„ è“ ç»¿ ç™½ é»‘"},
        {unit:2,id:"2-5",title:"è¯¾æ–‡ï¼šä¸€åˆ†é’Ÿ",chars:"åˆ† é’Ÿ é’Ÿ è¡¨ å¿« æ…¢"},
        {unit:3,id:"3-6",title:"è¯¾æ–‡ï¼šè¯¾é—´ååˆ†é’Ÿ",chars:"é—´ æ“ åœº è·³ è·‘"},
        {unit:3,id:"3-7",title:"è¯¾æ–‡ï¼šé£",chars:"é£ å¹ äº‘ åŠ¨"},
        {unit:4,id:"4-8",title:"è¯¾æ–‡ï¼šè¯­æ–‡å›­åœ°è¯è¯­",chars:"æ˜¥ é£ å¤ é›¨ ç§‹ æœ å†¬ é›ª"},
      ],
      "2ä¸‹": [
        // â˜… äºŒå¹´çº§ä¸‹ï¼šä½ å‰é¢ç¡®è®¤çš„å…¨å†Œæ•°æ®ï¼ˆç²¾ç®€ç¤ºä¾‹ï¼šå¯ç”¨ï¼›å¦‚éœ€å®˜æ–¹å…¨é‡å¯åœ¨â€œç¼–è¾‘â€ç²˜è´´ï¼‰
        {unit:1,id:'1-1', title:'å¤è¯—ä¸¤é¦–ï¼ˆæ‘å±…/å’æŸ³ï¼‰', chars:'è¯— æ‘ ç«¥ ç¢§ å¦† ç»¿ ä¸ å‰ª' },
        {unit:1,id:'1-2', title:'æ‰¾æ˜¥å¤©', chars:'å†² å¯» å§‘ å¨˜ å æŸ³ è¡ æ¡ƒ æ' },
        {unit:1,id:'1-3', title:'å¼€æ»¡é²œèŠ±çš„å°è·¯', chars:'é²œ é‚® é€’ å‘˜ åŸ å” è½¦ å±€ ç¤¼' },
        {unit:1,id:'1-4', title:'é‚“å°å¹³çˆ·çˆ·æ¤æ ‘', chars:'é‚“ æ¤ å¼• æ³¨ æ»¡ ä¼‘ æ¯' },

        {unit:2,id:'2-5', title:'é›·é”‹å”å”ï¼Œä½ åœ¨å“ªé‡Œ', chars:'é”‹ æ˜¨ å†’ ç•™ å¼¯ èƒŒ æ´’ æ¸© æš–' },
        {unit:2,id:'2-6', title:'åƒäººç³•', chars:'èƒ½ æ¡Œ å‘³ ä¹° å…· ç”˜ ç”œ èœ åŠ³' },
        {unit:2,id:'2-7', title:'ä¸€åŒ¹å‡ºè‰²çš„é©¬', chars:'åŒ¹ å¦¹ æ³¢ çº¹ åƒ æ™¯ æ‹ èˆ æ±‚' },

        {unit:3,id:'3-8', title:'è¯†å­—ï¼šç¥å·è°£', chars:'å· æ¹¾ å²› å³¡ æ°‘ æ— è°Š' },
        {unit:3,id:'3-9', title:'ä¼ ç»ŸèŠ‚æ—¥', chars:'ç«¯ ç²½ èˆŸ é¼“ æ— æ°‘ åº† ç¯ è´´ è” æ‹œ' },
        {unit:3,id:'3-10', title:'ä¸­å¤–èŠ‚æ—¥', chars:'åœ£ æ—¦ èŠ‚ å·§ èœ¡ çƒ› å¤ æ´» æ„Ÿ æ© ç‹‚ æ¬¢' },

        {unit:4,id:'4-11', title:'å½©è™¹', chars:'è™¹ é›¨ ä¼ æŒ¡ é€ é—ª ç¿ çƒ‚' },
        {unit:4,id:'4-12', title:'æˆ‘æ˜¯ä¸€åªå°è™«å­', chars:'è™« å‚ æ–‘ è§… æ• ä¼ª è£…' },
        {unit:4,id:'4-13', title:'æ¤ç‰©å¦ˆå¦ˆæœ‰åŠæ³•', chars:'æ—… èƒ è‹— è£‚ é£˜ ç¿… ä¼¸ æŒº' },

        {unit:5,id:'5-14', title:'å¤è¯—ä¸¤é¦–ï¼ˆç»å¥/æ±Ÿå—æ˜¥ï¼‰', chars:'ç» æ±Ÿ å— æ˜¥ ç¹' },
        {unit:5,id:'5-15', title:'æ—¥æœˆæ½­', chars:'æ½­ å° æ¹¾ æ‘ æ°‘ æ¸¸ é¸Ÿ ç»¿ å²›' },
        {unit:5,id:'5-16', title:'è‘¡è„æ²Ÿ', chars:'è‘¡ è„ ç»“ æŒ‚ éœ² æ‘‡ ç ç ' },
        {unit:5,id:'5-17', title:'ç«çƒ§äº‘', chars:'çƒ§ äº‘ éœ æ™š ç‚ äº® çº¢' },

        {unit:6,id:'6-18', title:'å‘¼é£å”¤é›¨çš„ä¸–çºª', chars:'å‘¼ å”¤ ä¸– çºª é¥ æ§ å« æ˜Ÿ ç« ç®­' },
        {unit:6,id:'6-19', title:'å¼ è¡¡é€ åœ°åŠ¨ä»ª', chars:'è¡¡ æµ‹ é“œ é›• ç‹® å å ç¯ ç¢°' },
        {unit:6,id:'6-20', title:'â€œç¥ç¬”é©¬è‰¯â€ï¼ˆèŠ‚é€‰ï¼‰', chars:'ç¬” é©¬ è‰¯ ç”» æ¸” è´´ å¢™ å˜ çœŸ å‡' },

        {unit:7,id:'7-21', title:'æ›¹å†²ç§°è±¡', chars:'æ›¹ å†² è±¡ æ²‰ ç§° ç§¤ é‡ å®˜ æ‹…' },
        {unit:7,id:'7-22', title:'é»„å±±å¥‡çŸ³', chars:'é»„ å±± å¥‡ å³° å£® æ€ª çŸ³' },
        {unit:7,id:'7-23', title:'çŒ´ç‹å‡ºä¸–ï¼ˆèŠ‚é€‰ï¼‰', chars:'çŒ´ ç‹ ä¸– æ´ åº™ çŸ³ è›‹ è£‚' },

        {unit:8,id:'8-24', title:'ä¸¤ä¸ªé“çƒåŒæ—¶è½åœ°', chars:'é“ çƒ åŒ æ—¶ è½ å® éªŒ é‡ ç‰©' },
        {unit:8,id:'8-25', title:'å¤ªç©ºç”Ÿæ´»è¶£äº‹', chars:'å¤ª ç©º èˆª å¤© å‘˜ é¤ æ¡Œ å¸¦ ç¬‘' },
        {unit:8,id:'8-26', title:'å¸é©¬å…‰', chars:'å¸ é©¬ å…‰ ç ¸ ç¼¸ æ€¥ æ™º' },
        {unit:8,id:'8-27', title:'çˆ±è¿ªç”Ÿ', chars:'çˆ± è¿ª ç”Ÿ å‘ æ˜ ç”µ ç¯ å® éªŒ' },
      ],
      "3ä¸Š": [
        // â˜… ä¸‰å¹´çº§ä¸Šï¼ˆæŒ‰äººæ•™ç‰ˆå¸¸è§ç›®å½•æ•´ç†ï¼›å¯åœ¨"ç¼–è¾‘"é‡Œå¾®è°ƒï¼‰
        { unit: 1, id: "1-1", title: "å¤§é’æ ‘ä¸‹çš„å°å­¦", chars: "æ™¨ ç»’ çƒ æ±‰ è‰³ æœ è£… æ‰® é™ åœ å­” é›€ ç²—" },
        { unit: 1, id: "1-2", title: "èŠ±çš„å­¦æ ¡", chars: "è½ è’ ç¬› èˆ ç‹‚ ç½š å‡ äº’ æ‰€ å¤Ÿ çŒœ æ‰¬ è‡‚" },
        { unit: 2, id: "2-3", title: "å¤è¯—ä¸‰é¦–", chars: "å¯’ å¾„ æ–œ éœœ èµ  åˆ˜ ç›– èŠ æ®‹ å› æ©™ é€ æŒ‘" },
        { unit: 2, id: "2-4", title: "é“ºæ»¡é‡‘è‰²å·´æŒçš„æ°´æ³¥é“", chars: "é“º æ³¥ æ™¶ é™¢ å¢™ å° æ’ åˆ— è§„ åˆ™ ä¹± æ£• è¿Ÿ" },
        { unit: 2, id: "2-5", title: "ç§‹å¤©çš„é›¨", chars: "ç›’ é¢œ æ–™ ç¥¨ é£˜ äº‰ ä»™ æ·¡ é—» æ¢¨ å‹¾ æ›² ä¸°" },
        { unit: 3, id: "3-6", title: "å»å¹´çš„æ ‘", chars: "å†· ç¦» ç­‰ æ–§ ç  è°· æŸ´ ç…¤ æ²¹ è¯‰ ç æ¥" },
        { unit: 3, id: "3-7", title: "åœ¨ç‰›è‚šå­é‡Œæ—…è¡Œ", chars: "æ—… å’± æ€œ æ•‘ å‘½ æ‹¼ æ‰« èƒƒ ç®¡ åˆš æµ æ³ª ç®—" },
        { unit: 4, id: "4-8", title: "æ€»ä¹Ÿå€’ä¸äº†çš„è€å±‹", chars: "æ´ å‡† å¤‡ æš´ å¢™ å£ é¥¿ èœ˜ è›› æ¼‚ æ’ é¥± æ™’" },
        { unit: 5, id: "5-9", title: "æ­èˆ¹çš„é¸Ÿ", chars: "æ­ äº² çˆ¶ æ²™ å•¦ å“ ç¾½ ç¿  å˜´ æ‚„ å å“¦ æ•" },
        { unit: 5, id: "5-10", title: "é‡‘è‰²çš„è‰åœ°", chars: "è’² è‹± ç›› è€ å–Š æ¬  é’“ è€Œ å¯Ÿ æ‹¢ è¶£ å–œ ç¡" },
        { unit: 6, id: "6-11", title: "å¤è¯—ä¸‰é¦–", chars: "æ–­ æ¥š è‡³ å­¤ å¸† é¥® åˆ é•œ æœª ç£¨ é¥ é“¶ ç›˜" },
        { unit: 6, id: "6-12", title: "å¯Œé¥¶çš„è¥¿æ²™ç¾¤å²›", chars: "å¯Œ ä¼˜ æµ… é”™ å²© è™¾ æŒº é¼“ æ•° åš å® è´µ" },
        { unit: 6, id: "6-13", title: "æµ·æ»¨å°åŸ", chars: "æ»¨ ç° æ¸” é èºº è½½ é  æ ½ äºš å¤ é™¤ è¸© æ´" },
        { unit: 6, id: "6-14", title: "ç¾ä¸½çš„å°å…´å®‰å²­", chars: "è„‘ è¢‹ ä¸¥ å® æŒ¡ è§† çº¿ å› æ˜¾ æ è½¯ åˆ® åº“" },
        { unit: 7, id: "7-15", title: "å¤§è‡ªç„¶çš„å£°éŸ³", chars: "å¦™ æ¼” å¥ ç´ æŸ” æ„Ÿ å— æ¿€ å‡» å™¨ æ»´ æ•² é¸£" },
        { unit: 7, id: "7-16", title: "çˆ¶äº²ã€æ ‘æ—å’Œé¸Ÿ", chars: "æœ é›¾ è’™ é¼» æ€» æŠ– éœ² æ¹¿ å¸ çŒ ç¿… è†€ é‡" },
        { unit: 7, id: "7-17", title: "å¸¦åˆºçš„æœ‹å‹", chars: "åˆº æ£ é¢— å¿½ ä¹ æš— ä¼¸ åŒ† æ²Ÿ èª å· è¿½ è…°" },
        { unit: 8, id: "8-18", title: "å¸é©¬å…‰", chars: "å¸ åº­ ç™» è·Œ ä¼— å¼ƒ æŒ" },
        { unit: 8, id: "8-19", title: "æŒå£°", chars: "æŒ ç­ é»˜ è…¿ è½® æŠ• è°ƒ æ‘‡ æ™ƒ çƒˆ å‹‡" },
        { unit: 8, id: "8-20", title: "ç°é›€", chars: "é›€ éƒŠ å…» ç²‰ ç²’ ç”· æˆ– è€… å†» æƒœ è‚¯ è¯š" }
      ],

      "3ä¸‹": [
        // â˜… ä¸‰å¹´çº§ä¸‹ï¼ˆæŒ‰äººæ•™ç‰ˆå¸¸è§ç›®å½•æ•´ç†ï¼›å¯åœ¨â€œç¼–è¾‘â€é‡Œå¾®è°ƒï¼‰
        // ç¬¬ä¸€å•å…ƒ
        {unit:1,id:"1-1",title:"å¤è¯—ä¸‰é¦–",chars:"é¸³ é¸¯ æƒ  å´‡ è±š å‡"},
        {unit:1,id:"1-2",title:"ç‡•å­",chars:"ä¼¶ ä¿ ç¿¼ æ¼¾ å€¦ é—² æ•£ çº¤ æ† ç—•"},
        {unit:1,id:"1-3",title:"è·èŠ±",chars:"æŒ¨ è“¬ èƒ€ ç¿© è¹ˆ"},
        {unit:1,id:"1-4",title:"æ˜†è™«å¤‡å¿˜å½•",chars:"å½• å‡¡ è· æ¬¾ ç»¸ è†œ ç ç›Š çº¦ èš‚ æ–‘"},

        // ç¬¬äºŒå•å…ƒ
        {unit:2,id:"2-5",title:"å®ˆæ ªå¾…å…”",chars:"å®‹ è€• é‡Š å†€"},
        {unit:2,id:"2-6",title:"é™¶ç½å’Œé“ç½",chars:"é™¶ ç½ éª„ è°¦ è™š æ‡¦ å¼± æ¼ ä»£ ä»·"},
        {unit:2,id:"2-7",title:"é¹¿è§’å’Œé¹¿è…¿",chars:"ç§° ç¦ çš± é… æ€¨ ç‹® é€¼ æ’’ æŒ£"},
        {unit:2,id:"2-8",title:"æ± å­ä¸æ²³æµ",chars:"æ»” æ¶¯ å¦‡ ç¢Œ éµ å¾ª å°Š éªŒ"},

        // ç¬¬ä¸‰å•å…ƒ
        {unit:3,id:"3-9",title:"å¤è¯—ä¸‰é¦–",chars:"å±  è‹ é­‚ é…’ ç‰§ å…„ å€"},
        {unit:3,id:"3-10",title:"çº¸çš„å‘æ˜",chars:"åˆ› æº å­˜ åˆ¶ éº» è”¡ ä¼¦ ç´¯ åˆ‡ é²œ æ¬§ æ´² ç¤¾"},
        {unit:3,id:"3-11",title:"èµµå·æ¡¥",chars:"å¿ æ‹± æµ åŒ  è®¡ å² çˆª æ™º æ…§ å†"},
        {unit:3,id:"3-12",title:"ä¸€å¹…åæ‰¬ä¸­å¤–çš„ç”»",chars:"æ‹© éƒ½ å®« æ‘Š è´© å ä½œ æ€ é©´ å¯¸ ä¹˜ ç¬¼ æ  è²Œ"},

        // ç¬¬å››å•å…ƒ
        {unit:4,id:"4-13",title:"èŠ±é’Ÿ",chars:"èŠ¬ èŠ³ å†… ä½œ ç‡¥ ç¼ é€‚ é›… å» ç»„"},
        {unit:4,id:"4-14",title:"èœœèœ‚",chars:"æ¦‚ é˜» æ‹¬ è¯¯ é€† é€” é™Œ è¶…"},
        {unit:4,id:"4-15",title:"å°è™¾",chars:"ç¼¸ éš™ æ€ æœ« å‰¯ é’³ æ è¾ƒ è…¹"},

        // ç¬¬äº”å•å…ƒ
        {unit:5,id:"5-16",title:"å®‡å®™çš„å¦ä¸€è¾¹",chars:"æ·Œ ç§˜ æ ‹ å ç»ª ç¯‡"},
        {unit:5,id:"5-17",title:"æˆ‘å˜æˆäº†ä¸€æ£µæ ‘",chars:"å¸Œ ç—’ é³„ ä¸ é›¶ è‚  é†‹"},

        // ç¬¬å…­å•å…ƒ
        {unit:6,id:"6-18",title:"ç«¥å¹´çš„æ°´å¢¨ç”»",chars:"å¢¨ æŸ“ ç¢ æµª æº… çˆ½"},
        {unit:6,id:"6-19",title:"å‰ƒå¤´å¤§å¸ˆ",chars:"å‰ƒ æ‰§ å¦ éª‚ ä»‡ æƒ¯ åˆ‘ æ›¿ å˜ æ‘¸"},
        {unit:6,id:"6-20",title:"è‚¥çš‚æ³¡",chars:"å»Š å’Œ æ‚  è‹¥ å¨‡ è–„ é¢¤ å· å·… å©´"},
        {unit:6,id:"6-21",title:"æˆ‘ä¸èƒ½å¤±ä¿¡",chars:"è€€ åº† ç›¼ å  æ­‰"},

        // ç¬¬ä¸ƒå•å…ƒ
        {unit:7,id:"7-22",title:"æˆ‘ä»¬å¥‡å¦™çš„ä¸–ç•Œ",chars:"å‘ˆ é›• å¹» è¾‰ èŠ’ å‰‘ å‹"},
        {unit:7,id:"7-23",title:"æµ·åº•ä¸–ç•Œ",chars:"çªƒ ç§ è­¦ è‚Œ ç«  èƒ è¾¾ ç…¤ å‚¨ å±"},
        {unit:7,id:"7-24",title:"ç«çƒ§äº‘",chars:"æª€ å–‚ ç›ˆ å½¤ è·ª åº™ æ¨¡ æ‰"},

        // ç¬¬å…«å•å…ƒ
        {unit:8,id:"8-25",title:"æ…¢æ€§å­è£ç¼å’Œæ€¥æ€§å­é¡¾å®¢",chars:"ç¼ ç®± å¤¸ æ­ª æ‰¿ è¢– è¡¬ è¡« è´Ÿ æ³„ è‰º"},
        {unit:8,id:"8-26",title:"æ–¹å¸½å­åº—",chars:"æ©± æ”¹ è•‰ æ‰£ åš· æºœ ç­’ è‘£"},
        {unit:8,id:"8-27",title:"æ¼",chars:"å©† è„Š è´¼ è« é¢  èƒ¶ æ—‹ çºµ"},
        {unit:8,id:"8-28",title:"æ£æ ¸",chars:"æ ¸ å¦» çˆ¹ çŠ æŠ˜ å›° ç‰² åºœ ç½¢ æ¶¨"},
        ],
    };

    // ========== åº”ç”¨é€»è¾‘ ==========
    const bookSelect = document.getElementById('bookSelect');
    const listEl = document.getElementById('lessonList');
    const progressInfoEl = document.getElementById('progressInfo');
    const currentCardEl = document.getElementById('currentCard');
    const currentHanziEl = document.getElementById('currentHanzi');
    const currentPinyinEl = document.getElementById('currentPinyin');
    
    // å­¦ä¹ çŠ¶æ€
    let currentDeck = [];
    let currentIndex = 0;
    let isStudyMode = false;

    function groupBy(arr, key){return arr.reduce((m,it)=>((m[it[key]]??=[]).push(it),m),{})}
    function unique(arr){return [...new Set(arr)]}
    function shuffle(arr){const a=arr.slice();for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}
    function getPinyinForChar(ch){
      try{
        // æ£€æŸ¥ pinyinPro æ˜¯å¦å¯ç”¨
        if (typeof pinyinPro === 'undefined') {
          console.warn('pinyinPro åº“æœªåŠ è½½');
          return '';
        }
        
        // ä½¿ç”¨ pinyin-pro åº“è·å–æ‹¼éŸ³
        const py = pinyinPro.pinyin(ch, { 
          toneType: 'mark',  // ä½¿ç”¨å£°è°ƒæ ‡è®°
          type: 'string',    // è¿”å›å­—ç¬¦ä¸²è€Œä¸æ˜¯æ•°ç»„
          multiple: false    // åªè¿”å›ç¬¬ä¸€ä¸ªè¯»éŸ³
        });
        
        console.log(`å­—ç¬¦ "${ch}" çš„æ‹¼éŸ³:`, py);
        return py || '';
      }catch(e){ 
        console.warn('è·å–æ‹¼éŸ³å¤±è´¥:', ch, e);
        return ''; 
      }
    }

    function renderLessonList(){
      const book = bookSelect.value;
      const LESSONS = DATA[book] || [];
      const grouped = groupBy(LESSONS,'unit');
      let html = '';
      Object.keys(grouped).sort((a,b)=>+a-+b).forEach(u=>{
        html += `<h4>ç¬¬${u}å•å…ƒ</h4>`;
        grouped[u].forEach(l=>{
          html += `
            <label class="lesson-item">
              <input type="checkbox" data-id="${l.id}" checked>
              <span>${l.title}</span>
            </label>`;
        });
      });
      listEl.innerHTML = html || '<div style="color:#999;padding:6px 4px;">æœ¬å†Œæš‚æ— æ•°æ®</div>';
    }

    function collectChars(){
      const book = bookSelect.value;
      const LESSONS = DATA[book] || [];
      const checks = [...listEl.querySelectorAll('input[type="checkbox"]')].filter(c=>c.checked);
      const chosenIds = new Set(checks.map(c=>c.dataset.id));
      const pool = [];
      LESSONS.forEach(l=>{
        if(chosenIds.size===0 || chosenIds.has(l.id)){
          const chars = (l.chars||'').split(/\s+/).filter(Boolean);
          pool.push(...chars);
        }
      });
      return unique(pool);
    }

    function buildDeck(){
      const pool = collectChars();
      if(pool.length===0){
        progressInfoEl.textContent = 'æ²¡æœ‰å¯ç”¨ç”Ÿå­—ï¼Œè¯·å…ˆåœ¨è®¾ç½®ä¸­é€‰æ‹©è¯¾æ–‡';
        return false;
      }
      
      const studyMode = document.getElementById('studyMode').value;
      if(studyMode === 'random') {
        currentDeck = shuffle(pool).map(ch=>({ch, py:getPinyinForChar(ch)}));
      } else {
        currentDeck = pool.map(ch=>({ch, py:getPinyinForChar(ch)}));
      }
      
      currentIndex = 0;
      isStudyMode = true;
      return true;
    }

    function showCurrentCard(){
      if(!isStudyMode || currentDeck.length === 0) return;
      
      const current = currentDeck[currentIndex];
      currentHanziEl.textContent = current.ch;
      currentPinyinEl.textContent = current.py || 'æš‚æ— æ‹¼éŸ³';
      
      // é‡ç½®å¡ç‰‡çŠ¶æ€
      currentCardEl.classList.remove('flipped');
      
      // æ›´æ–°è¿›åº¦ä¿¡æ¯
      progressInfoEl.textContent = `${currentIndex + 1} / ${currentDeck.length}`;
      
      // æ˜¾ç¤º/éšè—æ§åˆ¶æŒ‰é’®
      document.getElementById('btnNext').style.display = currentIndex < currentDeck.length - 1 ? 'block' : 'none';
      document.getElementById('btnPrev').style.display = currentIndex > 0 ? 'block' : 'none';
    }

    function nextCard(){
      if(currentIndex < currentDeck.length - 1) {
        currentIndex++;
        showCurrentCard();
      }
    }

    function prevCard(){
      if(currentIndex > 0) {
        currentIndex--;
        showCurrentCard();
      }
    }

    function startStudy(){
      if(buildDeck()) {
        showCurrentCard();
        document.getElementById('btnStart').style.display = 'none';
        document.getElementById('btnNext').style.display = 'block';
        document.getElementById('btnPrev').style.display = 'block';
        document.getElementById('btnShuffle').style.display = 'block';
        progressInfoEl.textContent = `1 / ${currentDeck.length}`;
      }
    }

    function shuffleCurrentDeck(){
      if(!isStudyMode || currentDeck.length === 0) return;
      
      // æ‰“ä¹±é¡ºåº
      currentDeck = shuffle(currentDeck);
      
      // è‡ªåŠ¨å›åˆ°ç¬¬ä¸€ä¸ªç”Ÿå­—
      currentIndex = 0;
      
      // æ˜¾ç¤ºå½“å‰å¡ç‰‡
      showCurrentCard();
      
      // æ˜¾ç¤ºæç¤º
      progressInfoEl.textContent = `1 / ${currentDeck.length} (å·²éšæœº)`;
      setTimeout(() => {
        progressInfoEl.textContent = `1 / ${currentDeck.length}`;
      }, 2000);
    }

    // äº‹ä»¶ç»‘å®š
    document.getElementById('btnSelectAll').onclick = ()=>{listEl.querySelectorAll('input[type="checkbox"]').forEach(c=>c.checked=true)};
    document.getElementById('btnClear').onclick = ()=>{listEl.querySelectorAll('input[type="checkbox"]').forEach(c=>c.checked=false)};
    document.getElementById('btnStart').onclick = startStudy;
    document.getElementById('btnNext').onclick = nextCard;
    document.getElementById('btnPrev').onclick = prevCard;
    document.getElementById('btnShuffle').onclick = shuffleCurrentDeck;
    document.getElementById('btnStartStudy').onclick = ()=>{startStudy(); document.getElementById('settingsModal').classList.remove('show');};
    document.getElementById('btnSettings').onclick = ()=>{document.getElementById('settingsModal').classList.add('show');};
    document.getElementById('btnCloseSettings').onclick = ()=>{document.getElementById('settingsModal').classList.remove('show');};
    currentCardEl.addEventListener('click', ()=>{currentCardEl.classList.toggle('flipped')});
    bookSelect.addEventListener('change', ()=>{renderLessonList(); resetStudy()});
    
    function resetStudy(){
      isStudyMode = false;
      currentDeck = [];
      currentIndex = 0;
      document.getElementById('btnStart').style.display = 'block';
      document.getElementById('btnNext').style.display = 'none';
      document.getElementById('btnPrev').style.display = 'none';
      document.getElementById('btnShuffle').style.display = 'none';
      progressInfoEl.textContent = 'ç‚¹å‡»"å¼€å§‹å­¦ä¹ "å¼€å§‹è¯†å­—';
      currentHanziEl.textContent = 'å­—';
      currentPinyinEl.textContent = 'zÃ¬';
      currentCardEl.classList.remove('flipped');
    }

    // ========== æ•°æ®ç¼–è¾‘å™¨ ==========
    const editModal = document.getElementById('editModal');
    const jsonArea = document.getElementById('jsonArea');
    const btnCancelEdit = document.getElementById('btnCancelEdit');
    const btnSave = document.getElementById('btnSave');
    const btnDownload = document.getElementById('btnDownload');

    // æ·»åŠ ç¼–è¾‘æŒ‰é’®åˆ°è®¾ç½®å¼¹çª—
    function addEditButton(){
      const settingsDialog = document.querySelector('#settingsModal .dialog');
      const editBtn = document.createElement('button');
      editBtn.textContent = 'ç¼–è¾‘æ•°æ®';
      editBtn.className = 'ghost';
      editBtn.style.marginTop = '10px';
      editBtn.onclick = ()=>{
        const book = bookSelect.value;
        const src = (DATA[book]||[]).map(x=>({unit:x.unit,id:x.id,title:x.title,chars:x.chars}));
        jsonArea.value = JSON.stringify(src, null, 2);
        editModal.classList.add('show');
      };
      settingsDialog.appendChild(editBtn);
    }

    btnCancelEdit.onclick = ()=> editModal.classList.remove('show');
    btnSave.onclick = ()=>{
      try{
        const parsed = JSON.parse(jsonArea.value);
        if(!Array.isArray(parsed)) throw new Error('JSON é¡¶å±‚åº”ä¸ºæ•°ç»„');
        const ok = parsed.every(it=>typeof it.unit==='number' && typeof it.id==='string' && typeof it.title==='string' && typeof it.chars==='string');
        if(!ok) throw new Error('æ¯é¡¹éœ€åŒ…å« {unit:number,id:string,title:string,chars:string}');
        DATA[bookSelect.value] = parsed;
        editModal.classList.remove('show');
        renderLessonList();
        resetStudy();
        alert('æ•°æ®å·²æ›´æ–°ï¼Œè¯·é‡æ–°å¼€å§‹å­¦ä¹ ');
      }catch(err){
        alert('è§£æå¤±è´¥ï¼š'+err.message);
      }
    };
    btnDownload.onclick = ()=>{
      const blob = new Blob([jsonArea.value], {type:'application/json;charset=utf-8'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `ç”Ÿå­—æ•°æ®-${bookSelect.value}.json`;
      a.click();
      URL.revokeObjectURL(a.href);
    };

    // ç­‰å¾…åº“åŠ è½½å®Œæˆåå†åˆå§‹åŒ–
    function initializeApp() {
      if (typeof pinyinPro === 'undefined') {
        console.warn('pinyinPro åº“æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
        // å»¶è¿Ÿé‡è¯•
        setTimeout(initializeApp, 1000);
        return;
      }
      
      console.log('pinyinPro åº“å·²æˆåŠŸåŠ è½½');
      renderLessonList();
      addEditButton();
      resetStudy();
    }

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeApp);
    } else {
      initializeApp();
    }
  </script>
</body>
</html>
